<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Docutils Testing</title>
<meta name="authors" content="Lea Wiemann &lt;LeWiemann&#64;gmail.com&gt;  David Goodger &lt;goodger&#64;python.org&gt;" />
<meta name="date" content="2007-05-31" />
<meta name="copyright" content="This document has been placed in the public domain." />
<link rel="stylesheet" href="../../docutils/writers/html4css1/html4css1.css" type="text/css" />
</head>
<body>
<div class="document" id="docutils-testing">
<h1 class="title"><a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> Testing</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Authors:</th>
<td>Lea Wiemann &lt;LeWiemann&#64;gmail.com&gt;
<br />David Goodger &lt;goodger&#64;python.org&gt;</td></tr>
<tr><th class="docinfo-name">Revision:</th>
<td>5174</td></tr>
<tr><th class="docinfo-name">Date:</th>
<td>2007-05-31</td></tr>
<tr><th class="docinfo-name">Copyright:</th>
<td>This document has been placed in the public domain.</td></tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#running-the-test-suite" id="id7">Running the Test Suite</a></li>
<li><a class="reference internal" href="#python-versions" id="id8">Python Versions</a></li>
<li><a class="reference internal" href="#unit-tests" id="id9">Unit Tests</a><ul>
<li><a class="reference internal" href="#writing-new-tests" id="id10">Writing New Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-tests" id="id11">Functional Tests</a><ul>
<li><a class="reference internal" href="#directory-structure" id="id12">Directory Structure</a></li>
<li><a class="reference internal" href="#the-testing-process" id="id13">The Testing Process</a></li>
<li><a class="reference internal" href="#creating-new-tests" id="id14">Creating New Tests</a></li>
<li><a class="reference internal" href="#the-default-configuration-file" id="id15">The Default Configuration File</a></li>
</ul>
</li>
</ul>
</div>
<p>When adding new functionality (or fixing bugs), be sure to add test
cases to the test suite.  Practise test-first programming; it's fun,
it's addictive, and it works!</p>
<p>This document describes how to run the Docutils test suite, how the
tests are organized and how to add new tests or modify existing tests.</p>
<div class="section" id="running-the-test-suite">
<h1><a class="toc-backref" href="#id7">Running the Test Suite</a></h1>
<p>Before checking in any changes, run the entire Docutils test suite to
be sure that you haven't broken anything.  From a shell:</p>
<pre class="literal-block">
cd docutils/test
./alltests.py
</pre>
</div>
<div class="section" id="python-versions">
<h1><a class="toc-backref" href="#id8">Python Versions</a></h1>
<p>The Docutils 0.4 release supports Python 2.1 <a class="footnote-reference" href="#py21" id="id1">[1]</a> or later, with
some features only working (and being tested) with Python 2.3+.
Therefore, you should actually have Pythons 2.1 <a class="footnote-reference" href="#py21" id="id2">[1]</a>, 2.2, 2.3, as
well as the latest Python installed and always run the tests on all of
them.  (A good way to do that is to always run the test suite through
a short script that runs <tt class="docutils literal"><span class="pre">alltests.py</span></tt> under each version of
Python.)  If you can't afford intalling 3 or more Python versions, the
edge cases (2.1 and 2.3) should cover most of it.</p>
<table class="docutils footnote" frame="void" id="py21" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>)</em> Python 2.1 may be used providing the compiler package is
installed.  The compiler package can be found in the Tools/
directory of Python 2.1's source distribution.</td></tr>
</tbody>
</table>
<p>Good resources covering the differences between Python versions:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.python.org/doc/2.2.3/whatsnew/whatsnew22.html">What's New in Python 2.2</a></li>
<li><a class="reference external" href="http://www.python.org/doc/2.3.5/whatsnew/whatsnew23.html">What's New in Python 2.3</a></li>
<li><a class="reference external" href="http://www.python.org/doc/2.4.1/whatsnew/whatsnew24.html">What's New in Python 2.4</a></li>
<li><a class="reference external" href="http://www.python.org/peps/pep-0290.html">PEP 290 - Code Migration and Modernization</a></li>
</ul>
</div>
<div class="section" id="unit-tests">
<h1><a class="toc-backref" href="#id9">Unit Tests</a></h1>
<p>Unit tests test single functions or modules (i.e. whitebox testing).</p>
<p>If you are implementing a new feature, be sure to write a test case
covering its functionality.  It happens very frequently that your
implementation (or even only a part of it) doesn't work with an older
(or even newer) Python version, and the only reliable way to detect
those cases is using tests.</p>
<p>Often, it's easier to write the test first and then implement the
functionality required to make the test pass.</p>
<div class="section" id="writing-new-tests">
<h2><a class="toc-backref" href="#id10">Writing New Tests</a></h2>
<p>When writing new tests, it very often helps to see how a similar test
is implemented.  For example, the files in the
<tt class="docutils literal"><span class="pre">test_parsers/test_rst/</span></tt> directory all look very similar.  So when
adding a test, you don't have to reinvent the wheel.</p>
<p>If there is no similar test, you can write a new test from scratch
using Python's <tt class="docutils literal"><span class="pre">unittest</span></tt> module.  For an example, please have a
look at the following imaginary <tt class="docutils literal"><span class="pre">test_square.py</span></tt>:</p>
<pre class="literal-block">
#!/usr/bin/python

# $Id: testing.txt 5174 2007-05-31 00:01:52Z wiemann $
# Author: Your Name &lt;your_email_address&#64;example.org&gt;
# Copyright: This module has been placed in the public domain.

&quot;&quot;&quot;
Test module for docutils.square.
&quot;&quot;&quot;

import unittest
import docutils.square


class SquareTest(unittest.TestCase):

    def test_square(self):
        self.assertEqual(docutils.square.square(0), 0)
        self.assertEqual(docutils.square.square(5), 25)
        self.assertEqual(docutils.square.square(7), 49)

    def test_square_root(self):
        self.assertEqual(docutils.square.sqrt(49), 7)
        self.assertEqual(docutils.square.sqrt(0), 0)
        self.assertRaises(docutils.square.SquareRootError,
                          docutils.square.sqrt, 20)


if __name__ == '__main__':
    unittest.main()
</pre>
<p>For more details on how to write tests, please refer to the
documentation of the <tt class="docutils literal"><span class="pre">unittest</span></tt> module.</p>
</div>
</div>
<div class="section" id="functional-tests">
<span id="functional"></span><h1><a class="toc-backref" href="#id11">Functional Tests</a></h1>
<p>The directory <tt class="docutils literal"><span class="pre">test/functional/</span></tt> contains data for functional tests.</p>
<p>Performing functional testing means testing the Docutils system as a
whole (i.e. blackbox testing).</p>
<div class="section" id="directory-structure">
<h2><a class="toc-backref" href="#id12">Directory Structure</a></h2>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">functional/</span></tt> The main data directory.<ul>
<li><tt class="docutils literal"><span class="pre">input/</span></tt> The input files.<ul>
<li><tt class="docutils literal"><span class="pre">some_test.txt</span></tt>, for example.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">output/</span></tt> The actual output.<ul>
<li><tt class="docutils literal"><span class="pre">some_test.html</span></tt>, for example.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">expected/</span></tt> The expected output.<ul>
<li><tt class="docutils literal"><span class="pre">some_test.html</span></tt>, for example.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">tests/</span></tt> The config files for processing the input files.<ul>
<li><tt class="docutils literal"><span class="pre">some_test.py</span></tt>, for example.</li>
<li><tt class="docutils literal"><span class="pre">_default.py</span></tt>, the <a class="reference internal" href="#default-configuration-file">default configuration file</a>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-testing-process">
<h2><a class="toc-backref" href="#id13">The Testing Process</a></h2>
<p>When running <tt class="docutils literal"><span class="pre">test_functional.py</span></tt>, all config files in
<tt class="docutils literal"><span class="pre">functional/tests/</span></tt> are processed.  (Config files whose names begin
with an underscore are ignored.)  The current working directory is
always Docutils' main test directory (<tt class="docutils literal"><span class="pre">test/</span></tt>).</p>
<p>For example, <tt class="docutils literal"><span class="pre">functional/tests/some_test.py</span></tt> could read like this:</p>
<pre class="literal-block">
# Source and destination file names.
test_source = &quot;some_test.txt&quot;
test_destination = &quot;some_test.html&quot;

# Keyword parameters passed to publish_file.
reader_name = &quot;standalone&quot;
parser_name = &quot;rst&quot;
writer_name = &quot;html&quot;
settings_overrides['output-encoding'] = 'utf-8'
# Relative to main ``test/`` directory.
settings_overrides['stylesheet_path'] = '../docutils/writers/html4css1/html4css1.css'
</pre>
<p>The two variables <tt class="docutils literal"><span class="pre">test_source</span></tt> and <tt class="docutils literal"><span class="pre">test_destination</span></tt> contain the
input file name (relative to <tt class="docutils literal"><span class="pre">functional/input/</span></tt>) and the output
file name (relative to <tt class="docutils literal"><span class="pre">functional/output/</span></tt> and
<tt class="docutils literal"><span class="pre">functional/expected/</span></tt>).  Note that the file names can be chosen
arbitrarily.  However, the file names in <tt class="docutils literal"><span class="pre">functional/output/</span></tt> <em>must</em>
match the file names in <tt class="docutils literal"><span class="pre">functional/expected/</span></tt>.</p>
<p>If defined, <tt class="docutils literal"><span class="pre">_test_more</span></tt> must be a function with the following
signature:</p>
<pre class="literal-block">
def _test_more(expected_dir, output_dir, test_case, parameters):
</pre>
<p>This function is called from the test case to perform tests beyond the
simple comparison of expected and actual output files.</p>
<p><tt class="docutils literal"><span class="pre">test_source</span></tt> and <tt class="docutils literal"><span class="pre">test_destination</span></tt> are removed from the
namespace, as are all variables whose names begin with an underscore
(&quot;_&quot;).  The remaining names are passed as keyword arguments to
<tt class="docutils literal"><span class="pre">docutils.core.publish_file</span></tt>, so you can set reader, parser, writer
and anything else you want to configure.  Note that
<tt class="docutils literal"><span class="pre">settings_overrides</span></tt> is already initialized as a dictionary <em>before</em>
the execution of the config file.</p>
</div>
<div class="section" id="creating-new-tests">
<h2><a class="toc-backref" href="#id14">Creating New Tests</a></h2>
<p>In order to create a new test, put the input test file into
<tt class="docutils literal"><span class="pre">functional/input/</span></tt>.  Then create a config file in
<tt class="docutils literal"><span class="pre">functional/tests/</span></tt> which sets at least input and output file names,
reader, parser and writer.</p>
<p>Now run <tt class="docutils literal"><span class="pre">test_functional.py</span></tt>.  The test will fail, of course,
because you do not have an expected output yet.  However, an output
file will have been generated in <tt class="docutils literal"><span class="pre">functional/output/</span></tt>.  Check this
output file for validity and correctness.  Then copy the file to
<tt class="docutils literal"><span class="pre">functional/expected/</span></tt>.</p>
<p>If you rerun <tt class="docutils literal"><span class="pre">test_functional.py</span></tt> now, it should pass.</p>
<p>If you run <tt class="docutils literal"><span class="pre">test_functional.py</span></tt> later and the actual output doesn't
match the expected output anymore, the test will fail.</p>
<p>If this is the case and you made an intentional change, check the
actual output for validity and correctness, copy it to
<tt class="docutils literal"><span class="pre">functional/expected/</span></tt> (overwriting the old expected output), and
commit the change.</p>
</div>
<div class="section" id="the-default-configuration-file">
<span id="default-configuration-file"></span><h2><a class="toc-backref" href="#id15">The Default Configuration File</a></h2>
<p>The file <tt class="docutils literal"><span class="pre">functional/tests/_default.py</span></tt> contains default settings.
It is executed just before the actual configuration files, which has
the same effect as if the contents of <tt class="docutils literal"><span class="pre">_default.py</span></tt> were prepended
to every configuration file.</p>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="testing.txt">View document source</a>.
Generated on: 2009-12-29 18:29 UTC.
Generated by <a class="reference external" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
